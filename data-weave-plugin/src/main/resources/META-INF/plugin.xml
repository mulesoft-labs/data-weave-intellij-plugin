<idea-plugin>
    <idea-version since-build="203.8084.24"/>
    <id>org.mule.tooling.intellij.dataweave.v2</id>
    <name>Mulesoft DataWeave 2.0 And RestSdk.</name>
    <version>2.0.6</version>
    <vendor email="mariano.achaval@mulesoft.com" url="https://github.com/mulesoft-labs/data-weave-intellij-plugin">
        Mulesoft
    </vendor>
    <description><![CDATA[
     This plugin add support for:
      <h1>DataWeave 2.0:</h1>
      <ul>
        <li> Completion</li>
        <li> Refactor</li>
        <li> Navigation</li>
        <li> Debugging</li>
        <li> Preview Support</li>
        <li> Type Information</li>
       </ul>
      <h1>RestSdk:</h1>
      <ul>
        <li> Completion</li>
        <li> Navigation</li>
        <li> Basic Validation</li>
        <li> DataWeave injection</li>
       </ul>
    ]]></description>

    <change-notes><![CDATA[
    <h1>v2.0-BETA</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Grammar Parsing</li>
            <li>Color Highlighting.</li>
            <li>Local Refactoring.</li>
            <li>Run/Debug Script.</li>
            <li>String Interpolation support.</li>
            <li>Simple mule config language injection.</li>
          </ul>
        </li>
      </ul>
    <h1>v2.0.2</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Initial Testing Framework</li>
          </ul>
        </li>
      </ul>
    <h1>v2.0.4</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Autocomplete</li>
            <li>Introduce Variable</li>
            <li>Introduce Constant</li>
            <li>Documentation</li>
            <li>Show Inferred Type</li>
            <li>Reformat Weave Document</li>
            <li>Spell checking</li>
            <li>Weave Preview support</li>
            <li>Regex validation</li>
            <li>Improved language injection in mule configuration and java literals</li>
            <li>Surround with log and DoBlock</li>
            <li>Go To Class support</li>
            <li>Migrate from V1 to V2 of DW</li>
            <li>Introduce Function</li>
            <li>Autocompletion of media types with writer properties</li>
            <li>Introduce Type</li>
            <li>Debugging tests</li>
          </ul>
        </li>
      </ul>
       <h1>v2.0.5</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Lots of Bug Fixes</li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.7</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Fix find usages</li>
            <li>Fix rename</li>
            <li>Make Agent tear down when it is not used</li>
          </ul>
        </li>
      </ul>
       <h1>v2.0.11</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Shows type hints and parameters names</li>
            <li>Fix grammar should support ! and fix issue with + on numbers and addition</li>
            <li>Improve extract method</li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.13</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Performance Improvement</li>
            <li>Fix error with WordScanner</li>
            <li>Fix NPE</li>            
          </ul>
        </li>
      </ul>
      <h1>v2.0.17</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Performance Improvement</li>
            <li>Fix error with outline on dynamic scripts</li>
            <li>Add support for weavedocs generation</li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.19</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Navigation/Find Usage of binary function support</li>
            <li>Fix wrong param name when calling function with default prefix</li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.21</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Small bug fix on type checker</li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.25</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Some UX improvements on the Preview Panel</li>
            <li>Several NPE</li>
            <li>Deadlock on read lock and DataWeaveService</li>
          </ul>
        </li>
      </ul>
       <h1>v2.0.27</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Lots of Autocompletion Improvements</li>
            <li>Better Parsing Error Handling and Error Messages</li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.29</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Fix New Scenario When DWIT is not present</li>
            <li>Fix Grammar for multiAttribute selector </li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.33</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>More variaty of versions supported</li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.35</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Autoescape string on pasting multiline.</li>
            <li>Add intention for persisting types.</li>
          </ul>
        </li>
      </ul>
         <h1>v2.0.38</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Some autocompletion fixes.</li>
            <li>Small UI teaks.</li>
            <li>Support for 2.3.0 syntax.</li>
            <li>Use latest wtf testing.</li>
          </ul>
        </li>
      </ul>
         <h1>v2.0.40</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Add support for optional field on function types.</li>
          </ul>
        </li>
      </ul>
          <h1>v2.0.42</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Fix build for latest IJ.</li>
            <li>Fix autocompletion of namespace elements.</li>
          </ul>
        </li>
      </ul>
          <h1>v2.0.44</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Update to latest Weave Tooling.</li>
            <li>Improve support for RAML modules.</li>
            <li>Add dependency graph view.</li>
            <li>Fix show parameters info.</li>
            <li>Add new icons.</li>
            <li>Add support for latest WaveTestingFramework.</li>
            <li>Use latest tooling api for better go to declaration.</li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.48</h1>
      <ul>
       <li>
          <p>DataWeave 2.0 Support</p>
          <ul>
            <li>Add support for multilinestring.</li>
            <li>Improve support for Weave Testing Framework.</li>
            <li>Add support for Weave Integration Test.</li>
            <li>Fix classcast.</li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.58</h1>
      <ul>
       <li>
          <p>RestSDK Support</p>
          <ul>
            <li>Basic Completion.</li>
            <li>Basic Navigation cross References.</li>
            <li>Wizard support for new RestSdk project.</li>
          </ul>
        </li>
      </ul>
      <h1>v2.0.60</h1>
      <ul>
       <li>
          <p>RestSDK Support</p>
          <ul>
            <li>Fix validation of missing property.</li>
          </ul>
        </li>
      </ul>
       <h1>v2.0.62</h1>
      <ul>
       <li>
          <p>RestSDK Support</p>
          <ul>
            <li>Add autocompletion of DW expressions with DataSense.</li>
            <li>Allow injected expressions to work with WeavePreview Tool.</li>
          </ul>
        </li>
      </ul>
    ]]>
    </change-notes>

    <depends>com.intellij.properties</depends>
    <depends>org.jetbrains.idea.maven</depends>
    <depends>com.intellij.modules.java</depends>
    <depends>org.jetbrains.plugins.yaml</depends>

    <extensionPoints>
        <extensionPoint name="inputOutputTypesProvider"
                        interface="org.mule.tooling.lang.dw.service.InputOutputTypesProvider"/>
        <extensionPoint name="nameIdentifierProvider"
                        interface="org.mule.tooling.lang.dw.util.NameIdentifierProvider"/>
    </extensionPoints>

    <!-- Begins  REST SDK -->
    <extensions defaultExtensionNs="org.mule.tooling.intellij.dataweave.v2">
        <inputOutputTypesProvider implementation="org.mule.tooling.restsdk.datasense.RestSdkInputOutputTypesProvider"/>
        <nameIdentifierProvider implementation="org.mule.tooling.restsdk.nameidentifier.RestSdkNameIdentifierProvider"/>
    </extensions>
    <extensions defaultExtensionNs="JavaScript.JsonSchema">
        <ProviderFactory implementation="org.mule.tooling.restsdk.schema.RestSdkDescriptorJsonSchemaProviderFactory"/>
    </extensions>
    <!-- FINISH REST SDK Extensions -->

    <extensions defaultExtensionNs="com.intellij">

        <intentionAction>
            <className>org.mule.tooling.lang.dw.intention.InsertTypeIntentionAction</className>
            <category>DataWeave</category>
        </intentionAction>

        <!--Data Weave-->
        <testFramework implementation="org.mule.tooling.lang.dw.testintegration.WeaveTestFramework" order="first"/>

        <configurationType implementation="org.mule.tooling.lang.dw.launcher.configuration.WeaveConfigurationType"/>
        <runConfigurationProducer
                implementation="org.mule.tooling.lang.dw.launcher.configuration.WeaveConfigurationProducer"/>

        <configurationType
                implementation="org.mule.tooling.lang.dw.launcher.configuration.ui.test.WeaveTestConfigurationType"/>
        <configurationType
                implementation="org.mule.tooling.lang.dw.launcher.configuration.ui.test.WeaveIntegrationTestConfigurationType"/>
        <runConfigurationProducer
                implementation="org.mule.tooling.lang.dw.launcher.configuration.ui.test.WeaveTestConfigurationProducer"/>

        <fileType name="Weave" language="Weave" implementationClass="org.mule.tooling.lang.dw.WeaveFileType"
                  fieldName="instance" extensions="dwl"/>
        <lang.parserDefinition language="Weave"
                               implementationClass="org.mule.tooling.lang.dw.parser.WeaveParserDefinition"/>
        <lang.syntaxHighlighterFactory language="Weave"
                                       implementationClass="org.mule.tooling.lang.dw.highlighter.WeaveSyntaxHighlighterFactory"/>
        <colorSettingsPage implementation="org.mule.tooling.lang.dw.highlighter.WeaveColorSettingsPage"/>
        <lang.braceMatcher language="Weave" implementationClass="org.mule.tooling.lang.dw.WeavePairedBraceMatcher"/>
        <quoteHandler fileType="Weave" className="org.mule.tooling.lang.dw.WeaveQuoteHandler"/>

        <gotoClassContributor implementation="org.mule.tooling.lang.dw.navigation.GotoMappingContributor"/>
        <fileBasedIndex implementation="org.mule.tooling.lang.dw.indexer.WeaveGlobalDefinitionsIndexer"/>
        <lang.refactoringSupport language="Weave"
                                 implementationClass="org.mule.tooling.lang.dw.refactor.WeaveRefactoringSupportProvider"/>
        <lang.elementManipulator forClass="org.mule.tooling.lang.dw.parser.psi.WeaveNamedElement"
                                 implementationClass="org.mule.tooling.lang.dw.parser.psi.WeaveNamedElementManipulator"/>
        <lang.findUsagesProvider language="Weave"
                                 implementationClass="org.mule.tooling.lang.dw.reference.WeaveFindUsagesProvider"/>
        <lang.foldingBuilder language="Weave" implementationClass="org.mule.tooling.lang.dw.folding.WeaveFolding"/>
        <annotator language="Weave" implementationClass="org.mule.tooling.lang.dw.annotator.WeaveAnnotator"/>
        <lang.psiStructureViewFactory language="Weave"
                                      implementationClass="org.mule.tooling.lang.dw.structure.WeaveStructureViewBuilderFactory"/>
        <completion.contributor language="Weave"
                                implementationClass="org.mule.tooling.lang.dw.completion.WeaveCompletionContributor"/>

        <qualifiedNameProvider implementation="org.mule.tooling.lang.dw.qn.WeaveQualifiedNameProvider"/>
        <xdebugger.breakpointType implementation="org.mule.tooling.lang.dw.debug.breakpoint.WeaveBreakpointType"/>

        <programRunner id="WeaveDebug" implementation="org.mule.tooling.lang.dw.debug.WeaveDebuggerRunner"
                       order="last"/>
        <languageInjector implementation="org.mule.tooling.lang.dw.injector.MuleLanguageInjector"/>
        <multiHostInjector implementation="org.mule.tooling.lang.dw.injector.YamlLanguageInjector"/>
        <languageInjector implementation="org.mule.tooling.lang.dw.injector.StringInterpolationLanguageInjector"/>

        <breadcrumbsInfoProvider implementation="org.mule.tooling.lang.dw.breadcrums.WeaveBreadcrumbsInfoProvider"/>
        <spellchecker.support language="Weave"
                              implementationClass="org.mule.tooling.lang.dw.spellchecker.WeaveSpellCheckerStrategy"/>
        <!--<toolWindow id="Design Center" anchor="bottom"-->
        <!--factoryClass="org.mule.tooling.lang.browser.BrowserToolWindowFactory"/>-->


        <toolWindow id="Weave Preview" anchor="bottom" icon="AllIcons.Actions.Preview"
                    factoryClass="org.mule.tooling.lang.dw.preview.PreviewToolWindowFactory"/>
        <codeInsight.parameterInfo language="Weave"
                                   implementationClass="org.mule.tooling.lang.dw.hints.WeaveParameterInfoHandler"/>
        <externalAnnotator language="Weave"
                           implementationClass="org.mule.tooling.lang.dw.annotator.WeaveValidatorAnnotator"/>
        <consoleFilterProvider implementation="org.mule.tooling.lang.dw.filter.DataWeaveConsoleFilterProvider"/>
        <elementDescriptionProvider
                implementation="org.mule.tooling.lang.dw.reference.WeaveElementDescriptionProvider"/>
        <regExpLanguageHost forClass="org.mule.tooling.lang.dw.parser.psi.WeaveRegexLiteral"
                            implementationClass="org.mule.tooling.lang.dw.regex.WeaveRegExpLanguageHost"/>
        <languageInjector implementation="org.mule.tooling.lang.dw.regex.WeaveRegExpInjector"/>
        <fileTemplateGroup implementation="org.mule.tooling.lang.dw.templates.WeaveFilesTemplateManager"/>
        <moduleBuilder builderClass="org.mule.tooling.lang.dw.wizard.WeaveModuleBuilder"/>
        <lang.surroundDescriptor language="Weave"
                                 implementationClass="org.mule.tooling.lang.dw.surround.WeaveSurroundDescriptor"/>
        <codeInsight.typeInfo language="Weave"
                              implementationClass="org.mule.tooling.lang.dw.hints.WeaveExpressionTypeProvider"/>
        <copyPastePostProcessor implementation="org.mule.tooling.lang.dw.migrator.V1ToV2PostProcessor"/>
        <copyPastePreProcessor implementation="org.mule.tooling.lang.dw.paste.StringLiteralPaste"/>

        <!--BAT-->

        <testFramework implementation="org.mule.tooling.bat.testintegration.BatTestFramework"/>
        <configurationType implementation="org.mule.tooling.bat.launcher.BatTestConfigurationType"/>
        <runConfigurationProducer implementation="org.mule.tooling.bat.launcher.BatTestConfigurationProducer"/>
        <toolWindow id="Weave Internals" anchor="bottom"
                    factoryClass="org.mule.tooling.lang.dw.develop_view.DevelopToolingWindowFactory"
                    icon="AllIcons.Actions.Dump"/>

        <applicationConfigurable instance="org.mule.tooling.lang.dw.settings.DataWeaveSettings" id="Anypoint DataWeave"
                                 displayName="Anypoint DataWeave"
                                 groupId="root"
        />

        <applicationService id="DataWeave State"
                            serviceImplementation="org.mule.tooling.lang.dw.settings.DataWeaveSettingsState"/>
        <codeInsight.parameterNameHints language="Weave"
                                        implementationClass="org.mule.tooling.lang.dw.hints.WeaveInlayParameterHintsProvider"/>
        <lang.commenter language="Weave"
                        implementationClass="org.mule.tooling.lang.dw.documentation.WeaveCodeDocumentationAwareCommenter"/>
        <lang.documentationProvider language="Weave"
                                    implementationClass="org.mule.tooling.lang.dw.documentation.WeaveCodeDocumentationProvider"/>
        <externalAnnotator language="Weave"
                           implementationClass="org.mule.tooling.lang.dw.annotator.WeaveDocsAnnotator"/>

        <highlightingPassFactory implementation="org.mule.tooling.lang.dw.hints.WeaveTypeHintPassFactory"/>

        <!--  REST-SDK      -->

        <psi.referenceContributor language="yaml"
                                  implementation="org.mule.tooling.restsdk.reference.RestSdkReferenceContributor"/>
        <moduleBuilder builderClass="org.mule.tooling.restsdk.wizzard.RestSdkModuleBuilder"/>

    </extensions>
    <actions>
        <action id="org.mule.tooling.lang.dw.actions.WeaveFmtAction"
                class="org.mule.tooling.lang.dw.actions.WeaveFmtAction"
                text="Reformat DataWeave"
                description="Reformats the Weave document using the weave formatter tool.">
            <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt r"/>
            <add-to-group group-id="CodeFormatGroup" anchor="last"/>
        </action>
        <action id="org.mule.tooling.lang.dw.actions.CreateNewFileAction"
                class="org.mule.tooling.lang.dw.actions.CreateNewFileAction" text="DataWeave Component"
                description="Create new dataWeave">
            <add-to-group group-id="NewGroup" anchor="first"/>
            <keyboard-shortcut keymap="$default" first-keystroke="shift ctrl W"/>
        </action>
        <action id="org.mule.tooling.lang.dw.actions.ShowTypeOfSelectionAction"
                class="org.mule.tooling.lang.dw.actions.ShowTypeOfSelectionAction" text="Type Of Selection"
                description="Shows the weave type of the selection">
            <keyboard-shortcut keymap="$default" first-keystroke="alt shift T"/>
        </action>
    </actions>

</idea-plugin>
